<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Deflatemod</title><meta charset="utf8"/><link rel="stylesheet" href="/home/balat/ocsigen/ocsigen.github.io/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/home/balat/ocsigen/html_of_wiki/client.js"></script></head><body><h1>Deflatemod</h1><h2> Usage </h2><h3> What is deflatemod?</h3><p>Deflatemod is a module for Ocsigen that allows you to
deflate content, using HTTP/1.1 mechanism. It supports gzip as well as
deflate.
</p><h3> What do I need to use deflatemod?</h3><p>You need the camlzip library by Xavier Leroy and a working Ocsigen
installation.
</p><h3> How do I use deflatemod?</h3><p>First, load the extension in the configuration file:
</p><pre>&lt;extension findlib-package=&quot;ocsigenserver.ext.deflatemod&quot; /&gt;
</pre><p>Alternatively, if you do not want to use findlib, you need to:
</p><ul><li> load camlzip
</li></ul><pre>&lt;extension module=&quot;/path/to/camlzip.cma&quot; /&gt;
</pre><ul><li> then load deflatemod
</li></ul><pre>&lt;extension module=&quot;/path/to/deflatemod.cmo&quot; /&gt;
</pre><h3> How do I configure deflatemod?</h3><p>Again, the options are in ocsigen.conf. You can set a few options globally, in the extension tag:
</p><ul><li> the compress level: from 0 (no compression) to 9. The higher, the
better compression rate you achieve. Conversely, the lower, the faster
it is. Default is 6.
</li><li> the buffer size: default is 1024. You shouldn't need to change this
one, but you can still try a few other values (any feedback welcomed).
</li></ul><p>For example:
</p><pre>&lt;extension module=&quot;/home/gabriel/ocsigen/extensions/deflatemod.cmo&quot;&gt;
&lt;compress level=&quot;6&quot; /&gt;
&lt;buffer size=&quot;1024&quot; /&gt;
&lt;/extension&gt;
</pre><p>Next, you '''have to''' specify which pages you whish to deflate, in which host/site (otherwise, deflatemod won't compress anything). See next question to do that.
</p><h3> I want to deflate only some files. Is it possible?</h3><p>To some extent, yes. You can '''exclude''' some files and deflate every other, according to their mime-type or extension (''ie.'' the end of the '''url''' in fact, not really the file name on the disk).
</p><p>Here is an example:
</p><pre>&lt;host&gt;
&lt;site&gt;
&lt;!-- ... --&gt;
&lt;/site&gt;

&lt;deflate compress=&quot;allbut&quot;&gt;
&lt;!-- deflate everything but *.tar.gz files and image/* files --&gt;
    &lt;extension&gt;.tar.gz&lt;/extension&gt;
    &lt;type&gt;image/*&lt;/type&gt;
&lt;/deflate&gt;
&lt;/host&gt;
</pre><p>As you can see, you must put the &lt;deflate&gt; tag at the very end of the &lt;host&gt; element. Indeed, Ocsigen deals with extensions sequentially, so if you put &lt;site&gt; or other elements '''after''' &lt;deflatemod&gt;, they won't be compressed.
</p><p>Conversely, you can choose to deflate '''only''' some files, based
on their mime-types or extension:
</p><pre>&lt;host&gt;
&lt;site&gt;
&lt;!-- ... --&gt;
&lt;/site&gt;

&lt;deflate compress=&quot;only&quot;&gt;
&lt;!-- deflate only text/html files --&gt;
    &lt;type&gt;text/html&lt;/type&gt;
&lt;/deflate&gt;
&lt;/host&gt;
</pre><p>Warning: you can use only one contenttype tag! So you must choose,
either the &quot;only&quot; or the &quot;allbut&quot; way.
</p><p>Limitations: you cannot filter by directory or by filename extension (remember extension is the url's extension). If you really need it, please fill a bug report or send a patch.
</p><h2> Technical questions </h2><h3> How can I choose the content-encoding (gzip or deflate)?</h3><p>You can't. Deflatemod follows the RFC and chooses automatically the
right encoding, based upon Accept-encoding header sent by the client.
</p><h3> Does deflatemod support transfert-encoding?</h3><p>No, it  doesn't. Content-encoding is definitely a better solution,
providing end to end compression at the content-level.
</p><h3> How does deflatemod deal with the content-length header?</h3><p>As it cannot compute the new content-length, deflatemod uses
chunked-encoding. This is the recommended way to go.
</p><p><em>Page written by Gabriel Kerneis</em>
</p></body></html>
