<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Module Ocsigen_cache.​Dlist </title><meta charset="utf8"/><link rel="stylesheet" href="/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/js/client.js"></script></head><body><h1>Module <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist">Ocsigen_cache.​Dlist</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Dlist</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Doubly-linked lists with maximum number of entries,
and (possibly) limited lifespan for entries.
</p><hr/><pre class="ocsforge_color odocwiki_code" id="TYPEt"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_type">'a</span> <span class="odocwiki_name">t</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEnode"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_type">'a</span> <span class="odocwiki_name">node</span></pre><pre class="ocsforge_color odocwiki_code" id="VALcreate"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">create</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_label">?timer:</span>float <span class="ocsforge_color_delimiter">-&gt;</span> int <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span></span></pre><div class="odocwiki_info"><p>Create a dlist. It takes the maximum length of the list as
parameter. The optional <span class="odocwiki_inlinecode">?timer</span> parameter sets a maximum
lifetime for elements (in seconds).</p></div><pre class="ocsforge_color odocwiki_code" id="VALadd"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">add</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a option</span></pre><div class="odocwiki_info"><p>Adds an element to the list,
and possibly returns the element that has been removed if the maximum
size was exceeded.</p></div><pre class="ocsforge_color odocwiki_code" id="VALremove"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">remove</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Removes an element from its list.
If it is not in a list, it does nothing.
If it is in a list, it calls the finaliser, then removes the element.
If the finaliser fails with an exception,
the element is removed and the exception is raised again.</p></div><pre class="ocsforge_color odocwiki_code" id="VALup"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">up</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Removes the element from its list without finalising,
then adds it as newest.</p></div><pre class="ocsforge_color odocwiki_code" id="VALnewest"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">newest</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> option</span></pre><pre class="ocsforge_color odocwiki_code" id="VALoldest"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">oldest</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> option</span></pre><pre class="ocsforge_color odocwiki_code" id="VALsize"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">size</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALmaxsize"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">maxsize</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int</span></pre><pre class="ocsforge_color odocwiki_code" id="VALvalue"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">value</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a</span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_timer"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_timer</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> float option</span></pre><div class="odocwiki_info"><p>returns the timer of the Dlist</p></div><pre class="ocsforge_color odocwiki_code" id="VALlist_of"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">list_of</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> option</span></pre><div class="odocwiki_info"><p>The list to which the node belongs</p></div><pre class="ocsforge_color odocwiki_code" id="VALremove_n_oldest"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">remove_n_oldest</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int <span class="ocsforge_color_delimiter">-&gt;</span> 'a list</span></pre><div class="odocwiki_info"><p>remove the n oldest values (or less if the list is not long enough) ;
returns the list of removed values</p></div><pre class="ocsforge_color odocwiki_code" id="VALfold"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">fold</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b</span></pre><div class="odocwiki_info"><p>fold over the elements from the cache starting from the newest
to the oldest</p></div><pre class="ocsforge_color odocwiki_code" id="VALfold_back"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">fold_back</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b</span></pre><div class="odocwiki_info"><p>fold over the elements from the cache starting from the oldest
to the newest</p></div><pre class="ocsforge_color odocwiki_code" id="VALlwt_fold"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">lwt_fold</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>lwt version of fold</p></div><pre class="ocsforge_color odocwiki_code" id="VALlwt_fold_back"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">lwt_fold_back</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'b <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>lwt version of fold_back</p></div><pre class="ocsforge_color odocwiki_code" id="VALmove"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">move</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a option</span></pre><div class="odocwiki_info"><p>Move a node from one dlist to another one, without finalizing.
If one value is removed from the destination list (because its
maximum size is reached), it is returned (after finalisation).</p></div><pre class="ocsforge_color odocwiki_code" id="VALset_maxsize"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_maxsize</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> int <span class="ocsforge_color_delimiter">-&gt;</span> 'a list</span></pre><div class="odocwiki_info"><p>change the maximum size ;
returns the list of removed values, if any.</p></div><pre class="ocsforge_color odocwiki_code" id="VALset_finaliser_before"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_finaliser_before</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span>'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>set a function to be called automatically on a piece of data
just before it disappears from the list
(either by explicit removal or because the maximum size is exceeded)</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_finaliser_before"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_finaliser_before</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><pre class="ocsforge_color odocwiki_code" id="VALset_finaliser_after"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_finaliser_after</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_delimiter">(</span>'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>set a function to be called automatically on a piece of data
just after it disappears from the list
(either by explicit removal or because the maximum size is exceeded)</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_finaliser_after"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_finaliser_after</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEt">t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.8/api/Ocsigen_cache.Dlist#TYPEnode">node</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre></body></html>
